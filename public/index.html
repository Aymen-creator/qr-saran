<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Saran Café – Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-gray-50 text-gray-900">
    <div class="max-w-3xl mx-auto p-6">
      <!-- Header -->
      <header class="flex flex-col items-center justify-center mb-8">
        <h1 class="text-3xl font-bold mb-1">Saran Café</h1>
        <p class="text-gray-500 text-sm">
          Scan the QR code on your table to browse our menu
        </p>
      </header>

      <!-- Search Bar -->
      <input
        type="text"
        id="search"
        placeholder="Search menu..."
        class="w-full p-3 mb-8 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500"
      />

      <!-- Menu Area -->
      <main id="menu-area" class="space-y-10">
        <!-- Menu categories will be generated here -->
      </main>

      <!-- Footer -->
      <footer class="mt-12 text-center text-gray-500 text-sm">
        © 2025 Saran Café
      </footer>
    </div>

    <!-- Supabase -->
    <script src="https://unpkg.com/@supabase/supabase-js"></script>

    <script type="module">
      // === Replace with your Supabase details ===
      const SUPABASE_URL = "https://kjqibulutfvihewdrenw.supabase.co";
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqcWlidWx1dGZ2aWhld2RyZW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODg3NTksImV4cCI6MjA3NTI2NDc1OX0.d1MOrXEWyKEyza3rzpgIn6qhDjGsh5RHsua3kqZkEpc";

      // Initialize Supabase client
      const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      // Load all items
      async function loadMenu() {
        const { data, error } = await supabase.from("menu_items").select("*");
        if (error) {
          console.error("Error loading menu:", error);
          return;
        }

        // Group items by category
        const categories = [
          "Hot Drinks",
          "Cold Drinks",
          "Juice",
          "Burger",
          "Salad",
          "Wrap",
        ];

        const grouped = {};
        categories.forEach((cat) => (grouped[cat] = []));

        data.forEach((item) => {
          if (grouped[item.category]) grouped[item.category].push(item);
        });

        renderMenu(grouped);
      }

      // Render grouped menu
      function renderMenu(grouped) {
        const menuArea = document.getElementById("menu-area");
        menuArea.innerHTML = "";

        for (const category in grouped) {
          const items = grouped[category];
          if (items.length === 0) continue;

          const section = document.createElement("section");
          section.innerHTML = `
            <h2 class="text-2xl font-bold mb-3 text-green-600">${category}</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              ${items
                .map(
                  (item) => `
                <div class="flex items-center gap-3 bg-white p-4 rounded-2xl shadow-sm hover:shadow-md transition">
                  <img src="${item.image_url}" alt="${item.name}" class="w-20 h-20 rounded-xl object-cover border" />
                  <div>
                    <h3 class="text-lg font-semibold">${item.name}</h3>
                    <p class="text-gray-600">ETB ${item.price}</p>
                  </div>
                </div>
              `
                )
                .join("")}
            </div>
          `;
          menuArea.appendChild(section);
        }
      }

      // Search
      document.getElementById("search").addEventListener("input", async (e) => {
        const searchTerm = e.target.value.toLowerCase();
        const { data } = await supabase.from("menu_items").select("*");
        const filtered = data.filter((i) =>
          i.name.toLowerCase().includes(searchTerm)
        );

        const grouped = {};
        filtered.forEach((item) => {
          if (!grouped[item.category]) grouped[item.category] = [];
          grouped[item.category].push(item);
        });

        renderMenu(grouped);
      });

      // Run on load
      loadMenu();
    </script>
  </body>
</html>
